"0",""
"0","## Include only countries with reductions in all three metrics"
"0",""
"0","inclusions <- data_totals %>% "
"0","  filter(!is.na(rate)) %>% "
"0","  group_by(country,iso,var) %>% "
"0","  summarise(rate=last(rate))"
"0",""
"0","inclusions <- inclusions %>%"
"0","  mutate(include=ifelse(rate<0,1,NA)) %>% "
"0","  group_by(country,iso) %>% "
"0","  mutate(include=sum(include)) %>% "
"0","  ungroup() %>% "
"0","  mutate(include=ifelse(!is.na(include),""yes"",""no""))"
"0",""
"0","inclusions <- inclusions %>%"
"0","  select(country,iso,include) %>% "
"0","  distinct()"
"0",""
"0",""
"0","## check if countries with earlier peak years also reduced in the past 10 years"
"0",""
"0","rates <- data_totals %>% filter(country==""nothing"")"
"0",""
"0","for (i in 1:length(unique(data_totals$country))) {"
"0","  "
"0","  temp_data <- data_totals %>% filter(country==unique(data_totals$country)[i])"
"0","  temp_data <- temp_data %>% "
"0","    group_by(var) %>% "
"0","    filter(year>=max(data_totals$year)-9)"
"0","  "
"0","  ## Exclusions"
"0","  temp_data <- temp_data %>% "
"0","    filter(!is.na(value)) %>% "
"0","    filter(include==0)"
"0","  "
"0","  ## Calculations"
"0","  temp_data <- temp_data %>% "
"0","    group_by(var) %>% "
"0","    mutate(rate=growth_rate(year,value)$rate) %>% "
"0","    mutate(fit=growth_rate(year,value)$data$predicted_x)"
"0","  "
"0","  rates <- rbind(rates,temp_data)"
"0","}"
"0",""
"0","rates <- rates %>% "
"0","  select(country,iso,var,rate) %>% "
"0","  distinct() %>% "
"0","  mutate(include=ifelse(rate<0,1,NA)) %>% "
"0","  group_by(country,iso) %>% "
"0","  mutate(include=sum(include)) %>% "
"0","  ungroup()"
"0"," "
"0","rates <- rates %>% "
"0","  mutate(include=ifelse(!is.na(include),""yes"",""no"")) %>% "
"0","  select(iso,include_past10=include) %>% "
"0","  distinct()"
"0",""
"0","inclusions <- inclusions %>% "
"0","  left_join(.,rates,by=join_by(iso))"
"0"," "
"0","inclusions <- inclusions %>% "
"0","  mutate(include=ifelse(include==""yes"" & include_past10==""yes"",""yes"",""no""))"
"0",""
"0",""
"0","length(inclusions$country[inclusions$include==""yes""])"
"1","[1]"
"1"," 26"
"1","
"
"0"," "
"0","write.xlsx(inclusions,""inclusions.xlsx"")"
"0",""
"0",""
