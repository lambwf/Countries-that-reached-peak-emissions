"0",""
"0","## Calculate national totals from the inventories, with and without LULUCF"
"0",""
"0","data_totals <- data_crts %>% "
"0","  filter(sector_lv1!=""Land use, land-use change and forestry"") %>% "
"0","  group_by(country,iso,year) %>% "
"0","  summarise(value_exLUC=sum(value,na.rm=T)/1e6)"
"0",""
"0","data_totals <- data_totals %>% "
"0","  left_join(.,data_crts %>%"
"0","              group_by(country,iso,year) %>% "
"0","              summarise(value_inLUC=sum(value,na.rm=T)/1e6),"
"0","            by = join_by(country, iso, year))"
"0",""
"0",""
"0","## Join consumption based CO2 from the Global Carbon Project"
"0",""
"0","data_cons <- read.xlsx(""sources/National_Fossil_Carbon_Emissions_2024v1.0.xlsx"",sheet=""Consumption Emissions"",startRow = 9)"
"0","data_cons <- data_cons %>% "
"0","  rename(year=X1) %>% "
"0","  gather(.,country,value_co2cons,-year) %>% "
"0","  mutate(year=as.numeric(year)) %>% "
"0","  mutate(value_co2cons=value_co2cons*(44/12)) %>% "
"0","  mutate(iso=countrycode(country,""country.name"",""iso3c"")) %>% "
"0","  select(-country)"
"2","Warnung: [38;5;232mThere was 1 warning in `mutate()`.[39m
[38;5;232m[36mâ„¹[38;5;232m In argument: `iso = countrycode(country, ""country.name"", ""iso3c"")`.[39m
Caused by warning:
[33m![39m Some values were not matched unambiguously: Africa, Asia, Bunkers, Central.America, EU27, Europe, Kosovo, KP.Annex.B, Middle.East, Non-OECD, Non.KP.Annex.B, North.America, Oceania, OECD, South.America, Statistical.Difference, World"
"0","data_totals <- data_totals %>% "
"0","  left_join(.,data_cons,by = join_by(iso, year))"
"0",""
"0",""
"0","## Filter to countries with annual data from at least 2000"
"0",""
"0","data_totals <- data_totals %>% "
"0","  mutate(include=ifelse(year>=2000,1,0)) %>% "
"0","  group_by(country,iso) %>% "
"0","  mutate(include=sum(include)) %>% "
"0","  filter(include>max(data_totals$year)-2000) %>% "
"0","  select(-include) %>% "
"0","  ungroup() %>% "
"0","  gather(.,var,value,value_inLUC,value_exLUC,value_co2cons)"
"0",""
"0",""
"0","## Filter out countries that are net negative in value_inLUC"
"0",""
"0","data_totals <- data_totals %>% "
"0","  mutate(include=ifelse(value<0,1,0)) %>% "
"0","  group_by(country,iso,var) %>% "
"0","  mutate(include=sum(include,na.rm=T))"
"0",""
"0",""
"0","## Find the years of peak emissions that occurred >10 years ago"
"0",""
"0","peak_years <- data_totals %>% "
"0","  filter(year<=max(data_totals$year)-10) %>% "
"0","  group_by(country,iso,var) %>% "
"0","  summarise(peak_year=year[which.max(value)])"
"2","Warnung: Returning more (or less) than 1 row per `summarise()` group was deprecated in dplyr 1.1.0.
Please use `reframe()` instead.
When switching from `summarise()` to `reframe()`, remember that `reframe()` always returns an ungrouped data frame and adjust accordingly."
"0","data_totals <- left_join(data_totals,peak_years,by=join_by(country,iso,var))"
"0",""
"0",""
"0","## calculate emissions growth since peak year"
"0",""
"0","rates <- data_totals %>% filter(country==""nothing"")"
"0",""
"0","for (i in 1:length(unique(data_totals$country))) {"
"0","  "
"0","  temp_data <- data_totals %>% filter(country==unique(data_totals$country)[i])"
"0","  temp_data <- temp_data %>% "
"0","    group_by(var) %>% "
"0","    filter(year>=first(peak_year))"
"0","  "
"0","  ## Exclusions"
"0","  temp_data <- temp_data %>% "
"0","    filter(!is.na(value)) %>% "
"0","    filter(include==0)"
"0","  "
"0","  ## Calculations"
"0","  temp_data <- temp_data %>% "
"0","    group_by(var) %>% "
"0","    mutate(rate=growth_rate(year,value)$rate) %>% "
"0","    mutate(fit=growth_rate(year,value)$data$predicted_x)"
"0","  "
"0","  rates <- rbind(rates,temp_data)"
"0","}"
"0",""
"0","data_totals <- data_totals %>% "
"0","  left_join(.,rates %>% select(country,iso,year,var,rate,fit),by=join_by(country,iso,year,var))"
"0",""
"0",""
"0",""
